---
layout: default
---
<!-- HERO SECTION -->
<section class="hero">
    <div class="container">
        <h1>{{ site.title }}</h1>
        <p>{{ site.description }}</p>
        
        <!-- ADS SLOT 1 (728x90) -->
        <div class="ads-container">
            <div class="ads-label">ADVERTISEMENT</div>
            <!-- Masukkan Kode AdSense di sini -->
        </div>
    </div>
</section>

<!-- MAIN CONTENT SECTION -->
<section id="channels" class="container main-section">
    <div class="section-header">
        <div class="title-wrapper">
            <span class="live-dot"></span>
            <h2>Channel Populer</h2>
        </div>
    </div>

    <!-- Container Grid Utama -->
    <div class="post-grid" id="post-container">
        {% for post in paginator.posts %}
        <article class="post-card animate-in">
            <a href="{{ post.url | relative_url }}" class="card-link-wrapper">
                <div class="thumb-container">
                    <img src="{{ post.image | relative_url }}" alt="{{ post.title }}" loading="lazy">
                    <span class="live-tag">LIVE</span>
                </div>
                <div class="post-info">
                    <span class="category">{{ post.category }}</span>
                    <h3>{{ post.title }}</h3>
                </div>
            </a>
        </article>
        {% endfor %}
    </div>

<!-- TRIGGER SECTION (Pemicu Scroll) -->
<div id="infinite-scroll-trigger" style="text-align: center; padding: 50px 0; min-height: 150px; width: 100%; clear: both;">
    {% if paginator.next_page %}
        <div id="pagination-nav">
            <!-- Gunakan filter relative_url agar jalur di GitHub Pages aman -->
            <a class="next-page" href="{{ paginator.next_page_path | relative_url }}" style="display: none;">Next</a>
            
            <div id="loading-indicator" style="display: none; color: #f59e0b; font-weight: 700;">
                <i class="fa fa-sync-alt fa-spin"></i> Memuat saluran lainnya...
            </div>
        </div>
    {% else %}
        <div style="color: #666; font-size: 0.8rem; padding: 20px;">Semua saluran telah ditampilkan</div>
    {% endif %}
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const container = document.getElementById('post-container');
    const trigger = document.getElementById('infinite-scroll-trigger');
    const loading = document.getElementById('loading-indicator');
    
    let isLoading = false;
    // Mencari link next-page secara dinamis
    let nextPageAnchor = document.querySelector('.next-page');

    if (!nextPageAnchor) {
        console.log("Sistem: Tidak ada halaman selanjutnya (Page 2 tidak ditemukan).");
        return;
    }

    // Fungsi Utama Fetch Data
    async function fetchNextPage() {
        if (isLoading || !nextPageAnchor) return;

        isLoading = true;
        loading.style.display = 'block';
        
        const targetUrl = nextPageAnchor.getAttribute('href');
        console.log("Sistem: Mencoba memuat konten dari " + targetUrl);

        try {
            const response = await fetch(targetUrl);
            if (!response.ok) throw new Error("Gagal mengambil halaman");
            
            const html = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // Ambil kartu-kartu baru dari container di halaman tujuan
            const newItems = doc.querySelectorAll('#post-container .post-card');
            
            if (newItems.length > 0) {
                newItems.forEach(item => {
                    // Pastikan animasi muncul tetap bekerja
                    item.classList.add('animate-in');
                    container.appendChild(item);
                });
                console.log("Sistem: Berhasil menambah " + newItems.length + " saluran.");

                // Cari link "Next" di halaman yang baru saja diambil
                const newerPageAnchor = doc.querySelector('.next-page');
                if (newerPageAnchor) {
                    // Update URL link untuk scroll berikutnya (misal ke page3)
                    nextPageAnchor.setAttribute('href', newerPageAnchor.getAttribute('href'));
                    console.log("Sistem: Link diperbarui ke " + newerPageAnchor.getAttribute('href'));
                } else {
                    // Jika tidak ada lagi halaman selanjutnya (Page 3 dst tidak ada)
                    nextPageAnchor = null;
                    trigger.innerHTML = "<div style='color: #666; font-size: 0.8rem;'>Semua saluran telah ditampilkan</div>";
                    observer.unobserve(trigger);
                }
            }
        } catch (err) {
            console.error("Sistem Error:", err);
            // Jika gagal, tampilkan tombol manual agar user bisa klik
            loading.innerHTML = "<button onclick='window.location.reload()' style='background:none; border:1px solid #f59e0b; color:#f59e0b; padding:5px 15px; border-radius:5px; cursor:pointer;'>Gagal memuat. Segarkan halaman?</button>";
        } finally {
            isLoading = false;
            loading.style.display = 'none';
        }
    }

    // Intersection Observer untuk deteksi otomatis saat scroll
    const observer = new IntersectionObserver((entries) => {
        if (entries[0].isIntersecting && !isLoading) {
            fetchNextPage();
        }
    }, { 
        rootMargin: '400px', // Load konten saat user 400px sebelum sampai bawah (sangat mulus)
        threshold: 0.1 
    });

    observer.observe(trigger);
});
</script>
