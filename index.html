---
layout: default
---
<section class="hero">
    <div class="container">
        <h1>Nonton TV Malaysia Online Gratis</h1>
        <p>Streaming siaran TV Malaysia kualiti HD, stabil, dan lancar.</p>
        <div class="ads-container">
            <div class="ads-label">ADVERTISEMENT</div>
            <!-- Slot Iklan AdSense -->
        </div>
    </div>
</section>

<section id="channels" class="container main-section">
    <div class="section-header">
        <div class="title-wrapper">
            <span class="live-dot"></span>
            <h2>Channel Populer</h2>
        </div>
    </div>

    <!-- Area Grid -->
    <div class="post-grid" id="post-container">
        {% for post in site.posts limit: 6 %}
        <article class="post-card animate-in">
            <a href="{{ post.url | relative_url }}" class="card-link-wrapper">
                <div class="thumb-container">
                    <img src="{{ post.image | relative_url }}" alt="{{ post.title }}" loading="lazy">
                    <span class="live-tag">LIVE</span>
                </div>
                <div class="post-info">
                    <span class="category">{{ post.category }}</span>
                    <h3>{{ post.title }}</h3>
                </div>
            </a>
        </article>
        {% endfor %}
    </div>

    <!-- Area Loading -->
    <div id="infinite-scroll-trigger" style="text-align: center; padding: 40px 0; min-height: 100px;">
        <div id="loading-indicator" style="display: none; color: #f59e0b; font-weight: 600;">
            <i class="fa fa-sync-alt fa-spin"></i> Memuat saluran lainnya...
        </div>
    </div>
</section>

<script>
document.addEventListener("DOMContentLoaded", function() {
    // VARIABEL UTAMA
    let postsShown = 6;      // Samakan dengan limit di Liquid di atas
    const postsPerLoad = 6;  // Berapa post yang muncul tiap scroll
    let allPosts = [];
    let isLoading = false;
    
    const container = document.getElementById('post-container');
    const trigger = document.getElementById('infinite-scroll-trigger');
    const loading = document.getElementById('loading-indicator');

    // 1. Ambil Data JSON (Menggunakan absolute path untuk GitHub Pages)
    fetch('/posts.json')
        .then(response => {
            if (!response.ok) throw new Error("File posts.json tidak ditemukan!");
            return response.json();
        })
        .then(data => {
            allPosts = data;
            console.log("Sistem Ready: " + allPosts.length + " total saluran ditemukan.");
            
            // Hanya aktifkan observer jika ada sisa postingan yang belum tampil
            if (allPosts.length > postsShown) {
                initObserver();
            } else {
                trigger.style.display = 'none';
            }
        })
        .catch(err => {
            console.error("Infinite Scroll Error:", err);
            trigger.innerHTML = "<small style='color:gray'>Semua saluran telah ditampilkan</small>";
        });

    // 2. Fungsi Load More
    function loadMore() {
        if (isLoading || postsShown >= allPosts.length) return;
        
        isLoading = true;
        loading.style.display = 'block';

        // Beri jeda sedikit agar loading terlihat halus
        setTimeout(() => {
            const nextPosts = allPosts.slice(postsShown, postsShown + postsPerLoad);
            
            nextPosts.forEach(post => {
                const article = document.createElement('article');
                article.className = 'post-card animate-in';
                article.innerHTML = `
                    <a href="${post.url}" class="card-link-wrapper">
                        <div class="thumb-container">
                            <img src="${post.image}" alt="${post.title}" loading="lazy">
                            <span class="live-tag">LIVE</span>
                        </div>
                        <div class="post-info">
                            <span class="category">${post.category}</span>
                            <h3>${post.title}</h3>
                        </div>
                    </a>
                `;
                container.appendChild(article);
            });

            postsShown += nextPosts.length;
            isLoading = false;
            loading.style.display = 'none';

            console.log("Post ditampilkan: " + postsShown + "/" + allPosts.length);

            if (postsShown >= allPosts.length) {
                trigger.innerHTML = "<small style='color:gray'>Selesai. Tidak ada lagi saluran.</small>";
                observer.unobserve(trigger);
            }
        }, 800);
    }

    // 3. Observer Sistem
    let observer;
    function initObserver() {
        observer = new IntersectionObserver((entries) => {
            if (entries[0].isIntersecting && !isLoading) {
                loadMore();
            }
        }, { rootMargin: '300px' }); // Load saat 300px sebelum mentok bawah
        
        observer.observe(trigger);
    }
});
</script>
