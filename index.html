---
layout: default
---
<section class="hero">
    <div class="container">
        <h1>{{ site.title }}</h1>
        <p>{{ site.description }}</p>
    </div>
</section>

<section id="channels" class="container main-section">
    <div class="section-header">
        <div class="title-wrapper">
            <span class="live-dot"></span>
            <h2>Channel Populer</h2>
        </div>
    </div>

    <!-- Container Grid Utama -->
    <div class="post-grid" id="post-container">
        {% for post in paginator.posts %}
        <article class="post-card animate-in">
            <a href="{{ post.url | relative_url }}" class="card-link-wrapper">
                <div class="thumb-container">
                    <img src="{{ post.image | relative_url }}" alt="{{ post.title }}" loading="lazy">
                    <span class="live-tag">LIVE</span>
                </div>
                <div class="post-info">
                    <span class="category">{{ post.category }}</span>
                    <h3>{{ post.title }}</h3>
                </div>
            </a>
        </article>
        {% endfor %}
    </div>

    <!-- Pemicu Scroll -->
    <div id="infinite-scroll-trigger" style="text-align: center; padding: 50px 0; min-height: 120px; width: 100%;">
        {% if paginator.next_page %}
            <!-- Link ini yang akan dicari oleh JavaScript -->
            <div id="pagination-nav">
                <a class="next-page" href="{{ paginator.next_page_path | relative_url }}" style="display: none;">Next</a>
                <div id="loading-indicator" style="color: #f59e0b; font-weight: 700;">
                    <i class="fa fa-sync-alt fa-spin"></i> Memuat saluran lainnya...
                </div>
            </div>
        {% else %}
            <small style="color: gray;">Semua saluran telah ditampilkan</small>
        {% endif %}
    </div>
</section>

<script>
document.addEventListener("DOMContentLoaded", function() {
    let container = document.getElementById('post-container');
    let trigger = document.getElementById('infinite-scroll-trigger');
    
    let isLoading = false;

    function initInfiniteScroll() {
        // Cari link halaman berikutnya
        let nextLink = document.querySelector('a.next-page');
        if (!nextLink) return;

        const observer = new IntersectionObserver((entries) => {
            if (entries[0].isIntersecting && !isLoading) {
                loadMore(nextLink.href);
            }
        }, { rootMargin: '400px' });

        observer.observe(trigger);
    }

    async function loadMore(url) {
        isLoading = true;
        console.log("Mengambil data dari: " + url);

        try {
            const response = await fetch(url);
            const text = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(text, 'text/html');
            
            // 1. Ambil post baru
            const newPosts = doc.querySelectorAll('#post-container .post-card');
            newPosts.forEach(post => {
                post.classList.add('animate-in');
                container.appendChild(post);
            });

            // 2. Update link "Next" untuk scroll berikutnya
            const nextLinkInDoc = doc.querySelector('a.next-page');
            const navWrapper = document.getElementById('pagination-nav');
            
            if (nextLinkInDoc) {
                // Ganti link lama dengan link baru dari halaman yang baru di-fetch
                let currentNextLink = document.querySelector('a.next-page');
                currentNextLink.href = nextLinkInDoc.href;
                isLoading = false;
                console.log("Next URL diperbarui ke: " + nextLinkInDoc.href);
            } else {
                // Jika sudah tidak ada halaman lagi
                trigger.innerHTML = "<small style='color: gray;'>Semua saluran telah ditampilkan</small>";
                isLoading = true; // Hentikan sistem
            }
        } catch (err) {
            console.error("Gagal memuat halaman:", err);
            isLoading = false;
        }
    }

    initInfiniteScroll();
});
</script>
