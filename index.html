---
layout: default
---
<!-- 1. HERO SECTION -->
<section class="hero">
    <div class="container">
        <h1>{{ site.title }}</h1>
        <p>{{ site.description }}</p>
    </div>
</section>

<!-- 2. MAIN CONTENT -->
<section id="channels" class="container main-section">
    <div class="section-header">
        <div class="title-wrapper">
            <span class="live-dot"></span>
            <h2>Channel Populer</h2>
        </div>
    </div>

    <!-- PENTING: ID 'post-container' harus ada di sini -->
    <div class="post-grid" id="post-container">
        {% for post in paginator.posts %}
        <article class="post-card">
            <a href="{{ post.url | relative_url }}" class="card-link-wrapper">
                <div class="thumb-container">
                    <img src="{{ post.image | relative_url }}" alt="{{ post.title }}" loading="lazy">
                    <span class="live-tag">LIVE</span>
                </div>
                <div class="post-info">
                    <span class="category">{{ post.category }}</span>
                    <h3>{{ post.title }}</h3>
                </div>
            </a>
        </article>
        {% endfor %}
    </div>

    <!-- 3. TRIGGER SECTION (Copy-Paste Bagian Ini Saja Jika Ingin Update) -->
    <div id="infinite-scroll-trigger" style="text-align: center; padding: 50px 0; min-height: 100px; width: 100%;">
        {% if paginator.next_page %}
            <div id="pagination-nav">
                <!-- WAJIB menggunakan Liquid tag {{ paginator.next_page_path | relative_url }} -->
                <a class="next-page" href="{{ paginator.next_page_path | relative_url }}" style="display: none;">Next</a>
                
                <div id="loading-indicator" style="display: none; color: #f59e0b; font-weight: 700;">
                    <i class="fa fa-sync-alt fa-spin"></i> Memuat saluran lainnya...
                </div>
            </div>
        {% else %}
            <div style="color: #666; font-size: 0.8rem;">Semua saluran telah ditampilkan</div>
        {% endif %}
    </div>
</section>

<!-- 4. SCRIPT INFINITE SCROLL MODERN -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    const container = document.querySelector('#post-container');
    const trigger = document.querySelector('#infinite-scroll-trigger');
    const loading = document.querySelector('#loading-indicator');
    
    let isLoading = false;

    // Fungsi Utama muat halaman selanjutnya
    async function loadMore() {
        // Cari link 'next-page' terbaru di dalam dokumen
        let nextLink = document.querySelector('a.next-page');
        
        if (!nextLink || isLoading) return;

        isLoading = true;
        loading.style.display = 'block';
        
        const urlToFetch = nextLink.href;
        console.log("Sistem: Mengambil konten dari " + urlToFetch);

        try {
            const response = await fetch(urlToFetch);
            const html = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // Ambil post-card baru dari halaman yang di-fetch
            const newPosts = doc.querySelectorAll('#post-container .post-card');
            
            if (newPosts.length > 0) {
                newPosts.forEach(post => {
                    post.classList.add('animate-in'); // Tambahkan efek muncul
                    container.appendChild(post);
                });

                // Update link 'next-page' dengan link yang ada di halaman baru
                const newerLink = doc.querySelector('a.next-page');
                if (newerLink) {
                    nextLink.href = newerLink.href;
                    console.log("Sistem: Link diperbarui ke " + newerLink.href);
                } else {
                    // Jika sudah tidak ada halaman lagi (Page 3 dst)
                    trigger.innerHTML = "<div style='color: #666; font-size: 0.8rem;'>Semua saluran telah ditampilkan</div>";
                    observer.unobserve(trigger);
                }
            }
        } catch (error) {
            console.error("Sistem Error:", error);
        } finally {
            isLoading = false;
            loading.style.display = 'none';
        }
    }

    // Intersection Observer untuk deteksi scroll otomatis
    const observer = new IntersectionObserver((entries) => {
        if (entries[0].isIntersecting) {
            loadMore();
        }
    }, { 
        rootMargin: '300px', // Mulai muat sebelum user sampai bawah
        threshold: 0.1 
    });

    if (document.querySelector('a.next-page')) {
        observer.observe(trigger);
    }
});
</script>
