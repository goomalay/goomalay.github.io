---
layout: default
---
<section class="hero">
    <div class="container">
        <h1>{{ site.title }}</h1>
        <p>{{ site.description }}</p>
    </div>
</section>

<section id="channels" class="container main-section">
    <div class="section-header">
        <div class="title-wrapper">
            <span class="live-dot"></span>
            <h2>Channel Populer</h2>
        </div>
    </div>

    <!-- Container Grid Utama -->
    <div class="post-grid" id="post-container">
        {% for post in paginator.posts %}
        <article class="post-card animate-in">
            <a href="{{ post.url | relative_url }}" class="card-link-wrapper">
                <div class="thumb-container">
                    <img src="{{ post.image | relative_url }}" alt="{{ post.title }}" loading="lazy">
                    <span class="live-tag">LIVE</span>
                </div>
                <div class="post-info">
                    <span class="category">{{ post.category }}</span>
                    <h3>{{ post.title }}</h3>
                </div>
            </a>
        </article>
        {% endfor %}
    </div>

    <!-- Bagian Pemicu (Trigger) -->
    <div id="pagination-trigger" style="text-align: center; padding: 50px 0; min-height: 100px;">
        {% if paginator.next_page %}
            <!-- Link rahasia yang akan dibaca oleh JavaScript -->
            <a id="next-page-link" href="{{ paginator.next_page_path | relative_url }}" style="display: none;">Next</a>
            
            <div id="loading-animation" style="display: none; color: #f59e0b; font-weight: 700;">
                <i class="fa fa-sync-alt fa-spin"></i> Memuat saluran lainnya...
            </div>
        {% else %}
            <small style="color: gray;">Semua saluran telah ditampilkan</small>
        {% endif %}
    </div>
</section>

<!-- SCRIPT AUTO-SCROLL HYBRID -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    let nextPageLink = document.getElementById('next-page-link');
    const container = document.getElementById('post-container');
    const loading = document.getElementById('loading-animation');
    const trigger = document.getElementById('pagination-trigger');
    
    let isLoading = false;

    if (!nextPageLink) return; // Berhenti jika tidak ada halaman selanjutnya

    const loadNextPage = async () => {
        if (isLoading || !nextPageLink) return;
        
        isLoading = true;
        loading.style.display = 'block';
        
        const nextUrl = nextPageLink.href;
        console.log("Mencoba mengambil konten dari:", nextUrl);

        try {
            const response = await fetch(nextUrl);
            const html = await response.text();
            
            // Buat dokumen virtual untuk memproses HTML yang diambil
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // Ambil semua post-card dari halaman selanjutnya
            const newPosts = doc.querySelectorAll('#post-container .post-card');
            
            // Masukkan post baru ke grid saat ini
            newPosts.forEach(post => {
                post.classList.add('animate-in'); // Tambahkan animasi muncul
                container.appendChild(post);
            });

            // Cari link halaman selanjutnya yang baru dari dokumen virtual
            const newNextPageLink = doc.getElementById('next-page-link');
            
            if (newNextPageLink) {
                nextPageLink.href = newNextPageLink.href; // Update URL untuk scroll berikutnya
            } else {
                nextPageLink = null; // Habis, tidak ada halaman lagi
                trigger.innerHTML = "<small style='color: gray;'>Semua saluran telah ditampilkan</small>";
            }

            console.log("âœ¨ Berhasil memuat " + newPosts.length + " saluran baru.");
        } catch (error) {
            console.error("Gagal memuat halaman selanjutnya:", error);
        } finally {
            isLoading = false;
            loading.style.display = 'none';
        }
    };

    // Deteksi Scroll menggunakan Intersection Observer (Lebih Ringan)
    const observer = new IntersectionObserver((entries) => {
        if (entries[0].isIntersecting) {
            loadNextPage();
        }
    }, { 
        rootMargin: '400px', // Mulai muat saat user 400px sebelum mentok bawah
        threshold: 0.1 
    });

    observer.observe(trigger);
});
</script>
