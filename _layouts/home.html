---
layout: default
---

<!-- HERO SECTION -->
<section class="hero">
    <div class="container">
        <h1>{{ site.title }}</h1>
        <p>{{ site.description }}</p>

        <!-- ADS SLOT HERO -->
        <div class="ads-container">
            <div class="ads-label">ADVERTISEMENT</div>
            <!-- Pasang kode AdSense di sini -->
        </div>
    </div>
</section>

<!-- MAIN CONTENT -->
<section id="channels" class="container main-section">
    <div class="section-header">
        <div class="title-wrapper">
            <span class="live-dot"></span>
            <h2>Channel Populer</h2>
        </div>
    </div>

    <!-- PENTING: Jangan hapus id="post-container" -->
    <div id="post-container" class="post-grid">
        {% for post in paginator.posts %}
        <article class="post-card">
            <a href="{{ post.url | relative_url }}" class="card-link-wrapper">
                <div class="thumb-container">
                    <img src="{{ post.image | relative_url }}" alt="{{ post.title }}" loading="lazy">
                    <span class="live-tag">LIVE</span>
                </div>
                <div class="post-info">
                    <span class="category">{{ post.category }}</span>
                    <h3>{{ post.title }}</h3>
                    <p class="program-desc">{{ post.program | truncate: 60 }}</p>
                </div>
            </a>
        </article>
        {% endfor %}
    </div>

    <!-- PAGINATION AREA -->
    {% if paginator.next_page %}
    <div class="pagination-nav">
        <button 
            id="loadMoreBtn"
            data-next="{{ paginator.next_page_path | relative_url }}"
            data-total-pages="{{ paginator.total_pages }}"
            data-current-page="{{ paginator.page }}"
            class="btn-page">
            Lihat Saluran Lainnya »
        </button>
        <p class="page-info" style="color: var(--text-muted); font-size: 0.8rem; margin-top: 10px;">
            Halaman {{ paginator.page }} dari {{ paginator.total_pages }}
        </p>
    </div>
    {% endif %}

    <!-- ADS SLOT BOTTOM -->
    <div class="ads-container" style="margin-top: 40px;">
        <div class="ads-label">ADVERTISEMENT</div>
        <!-- Pasang kode AdSense di sini -->
    </div>
</section>

<!-- SCRIPT LOAD MORE (VERSI PERBAIKAN) -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    const btn = document.getElementById("loadMoreBtn");
    const postContainer = document.getElementById("post-container");

    if (!btn || !postContainer) {
        console.log("Load More tidak diperlukan atau elemen tidak ditemukan");
        return;
    }

    btn.addEventListener("click", async function () {
        let nextPageUrl = btn.getAttribute("data-next");
        if (!nextPageUrl) {
            console.log("Tidak ada halaman berikutnya");
            return;
        }

        // Simpan teks asli untuk reset jika error
        const originalText = btn.innerText;
        btn.innerText = "Sedang Memuat...";
        btn.disabled = true;

        console.log("Mengambil halaman:", nextPageUrl);

        try {
            const response = await fetch(nextPageUrl);
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            
            const html = await response.text();
            
            // Gunakan regex untuk mengambil hanya bagian post-card
            // Ini lebih aman daripada parsing seluruh HTML
            const postMatches = html.match(/<article class="post-card">[\s\S]*?<\/article>/g);
            
            if (postMatches && postMatches.length > 0) {
                // Tambahkan setiap post ke container
                postMatches.forEach(postHtml => {
                    postContainer.insertAdjacentHTML('beforeend', postHtml);
                });
                
                console.log(`${postMatches.length} post berhasil ditambahkan`);
                
                // Update URL untuk halaman berikutnya
                const currentPage = parseInt(btn.getAttribute("data-current-page")) || 1;
                const nextPage = currentPage + 1;
                const totalPages = parseInt(btn.getAttribute("data-total-pages")) || 1;
                
                // Update atribut data
                btn.setAttribute("data-current-page", nextPage);
                
                // Cek apakah masih ada halaman berikutnya
                if (nextPage < totalPages) {
                    // Update URL untuk halaman berikutnya
                    const newNextUrl = nextPageUrl.replace(/page=\d+/, `page=${nextPage + 1}`);
                    btn.setAttribute("data-next", newNextUrl);
                    
                    // Update teks tombol
                    btn.innerText = `Lihat Halaman ${nextPage + 1} »`;
                    btn.disabled = false;
                    
                    // Update info halaman
                    const pageInfo = document.querySelector('.page-info');
                    if (pageInfo) {
                        pageInfo.textContent = `Halaman ${nextPage} dari ${totalPages}`;
                    }
                } else {
                    // Tidak ada halaman lagi
                    btn.innerText = "Semua saluran telah ditampilkan";
                    btn.disabled = true;
                    btn.classList.add("btn-finished");
                    
                    // Update info halaman
                    const pageInfo = document.querySelector('.page-info');
                    if (pageInfo) {
                        pageInfo.textContent = `Halaman ${totalPages} dari ${totalPages} - Semua konten ditampilkan`;
                    }
                }
            } else {
                // Jika tidak menemukan post, coba metode parsing HTML
                console.log("Mencoba metode parsing HTML...");
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                // Cari semua post-card dalam dokumen
                const newPosts = doc.querySelectorAll('.post-card');
                
                if (newPosts.length > 0) {
                    newPosts.forEach(post => {
                        postContainer.appendChild(post.cloneNode(true));
                    });
                    
                    // Update tombol load more dari halaman berikutnya
                    const nextBtn = doc.getElementById('loadMoreBtn');
                    if (nextBtn && nextBtn.getAttribute('data-next')) {
                        btn.setAttribute('data-next', nextBtn.getAttribute('data-next'));
                        btn.setAttribute('data-current-page', nextBtn.getAttribute('data-current-page') || nextPage);
                        btn.innerText = "Lihat Saluran Lainnya »";
                        btn.disabled = false;
                    } else {
                        btn.innerText = "Semua saluran telah ditampilkan";
                        btn.disabled = true;
                        btn.classList.add("btn-finished");
                    }
                } else {
                    throw new Error("Tidak menemukan post baru");
                }
            }
            
        } catch (error) {
            console.error("Error saat load more:", error);
            btn.innerText = "Gagal memuat. Klik untuk coba lagi";
            btn.disabled = false;
            
            // Set timeout untuk reset tombol
            setTimeout(() => {
                btn.innerText = originalText;
            }, 3000);
        }
    });
});
</script>
